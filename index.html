<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Layout Analyzer Pro</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code&display=swap" rel="stylesheet">
		<style>
			:root {
				--primary-color-start: #4f46e5;
				--primary-color-end: #8b5cf6;
				--secondary-color-start: #06b6d4;
				--secondary-color-end: #34d399;
				--background-color: #f8fafc;
				--card-background: #ffffff;
				--text-color: #111827;
				--text-muted-color: #4b5563;
				--border-color: #e2e8f0;
				--code-background: #1f2937;
				--code-text: #f3f4f6;
				--tooltip-background: #1f2937;
				--tooltip-text: #fff;
			}
			.dark {
				--primary-color-start: #6366f1;
				--primary-color-end: #a855f7;
				--secondary-color-start: #22d3ee;
				--secondary-color-end: #4ade80;
				--background-color: #0b1120;
				--card-background: #1e293b;
				--text-color: #e2e8f0;
				--text-muted-color: #94a3b8;
				--border-color: #334155;
				--code-background: #0f172a;
				--code-text: #cbd5e1;
				--tooltip-background: #1e293b;
				--tooltip-text: #e2e8f0;
			}
			.theme-emerald {
				--primary-color-start: #10b981;
				--primary-color-end: #34d399;
				--secondary-color-start: #059669;
				--secondary-color-end: #10b981;
			}
			.dark.theme-emerald {
				--primary-color-start: #34d399;
				--primary-color-end: #6ee7b7;
				--secondary-color-start: #22c55e;
				--secondary-color-end: #4ade80;
			}
			.theme-rose {
				--primary-color-start: #e11d48;
				--primary-color-end: #f43f5e;
				--secondary-color-start: #fb7185;
				--secondary-color-end: #fda4af;
			}
			.dark.theme-rose {
				--primary-color-start: #f43f5e;
				--primary-color-end: #fb7185;
				--secondary-color-start: #fda4af;
				--secondary-color-end: #fecaca;
			}

			html {
				scroll-behavior: smooth;
			}
			body {
				font-family: 'Inter', sans-serif;
				background-color: var(--background-color);
				background-image: radial-gradient(var(--border-color) 1px, transparent 1px);
				background-size: 24px 24px;
				color: var(--text-color);
				transition: background-color 0.3s ease, color 0.3s ease;
			}
			.step-card {
				background-color: var(--card-background);
				border-radius: 0.75rem;
				border: 1px solid var(--border-color);
				box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.05), 0 4px 6px -4px rgb(0 0 0 / 0.05);
				opacity: 0;
				transform: translateY(20px);
				transition: opacity 0.6s ease-out, transform 0.6s ease-out, background-color 0.3s ease, border-color 0.3s ease;
			}
			.step-card.is-visible {
				opacity: 1;
				transform: translateY(0);
			}
			.btn {
				background-image: linear-gradient(to right, var(--primary-color-start), var(--primary-color-end));
				transition: all 0.2s ease;
				transform: translateY(0);
			}
			.btn:hover {
				transform: translateY(-2px);
				box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
			}
			.btn-secondary {
				background-image: linear-gradient(to right, var(--secondary-color-start), var(--secondary-color-end));
				transition: all 0.2s ease;
				transform: translateY(0);
			}
			.btn-secondary:hover {
				transform: translateY(-2px);
				box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
			}
			.file-drop-zone {
				border: 2px dashed var(--border-color);
				transition: all 0.3s ease;
			}
			.file-drop-zone.dragover {
				border-color: var(--primary-color-end);
				background-color: var(--background-color);
			}
			.file-drop-zone.has-file {
				border-color: var(--secondary-color-end);
				background-color: var(--background-color);
			}
			.is-loading {
				border-color: var(--primary-color-end);
				background-color: var(--background-color);
				animation: pulse 2s infinite;
			}
			@keyframes pulse {
				0%,
				100% {
					opacity: 1;
				}
				50% {
					opacity: 0.7;
				}
			}
			.sql-box {
				font-family: 'Fira Code', monospace;
				background-color: var(--code-background);
				color: var(--code-text);
			}
			.table-container {
				max-height: 80vh;
				overflow: auto;
				border-radius: 0.5rem;
				border: 1px solid var(--border-color);
			}
			thead th {
				position: sticky;
				top: 0;
				z-index: 10;
				background-color: var(--card-background);
				border-bottom: 2px solid var(--border-color);
				color: var(--text-muted-color);
			}
			.section-header>th {
				position: sticky;
				top: 52px;
				z-index: 9;
				background-color: var(--card-background);
				border-bottom: 2px solid var(--border-color);
				color: var(--text-muted-color);
			}
			.tooltip {
				position: relative;
				cursor: help;
				border-bottom: 1px dotted var(--text-muted-color);
			}
			.tooltip .tooltiptext {
				visibility: hidden;
				width: 120px;
				background-color: var(--tooltip-background);
				color: var(--tooltip-text);
				text-align: center;
				border-radius: 6px;
				padding: 5px 0;
				position: absolute;
				z-index: 50;
				bottom: 125%;
				left: 50%;
				margin-left: -60px;
				opacity: 0;
				transition: opacity 0.3s;
			}
			.tooltip:hover .tooltiptext {
				visibility: visible;
				opacity: 1;
			}
			.progress-bar {
				background-image: linear-gradient(to right, var(--primary-color-start), var(--primary-color-end));
				transition: width 0.5s ease;
			}
			@keyframes pop-in {
				0% {
					opacity: 0;
					transform: scale(0.8);
				}
				100% {
					opacity: 1;
					transform: scale(1);
				}
			}
			.final-animation {
				animation: pop-in 0.5s ease-out forwards;
			}
			.chart-bar {
				background-color: var(--primary-color);
				transition: width 1s ease-out;
			}
			#back-to-top {
				position: fixed;
				bottom: 2rem;
				right: 2rem;
				display: none;
			}
			.pinned-col {
				position: sticky;
				background-color: var(--card-background);
			}
			.pinned-col-1 {
				left: 0;
			}
			.pinned-col-2 {
				left: 200px;
			}
			.dependency-child {
				padding-left: 2rem !important;
			}
			.dependency-child::before {
				content: '└─';
				padding-right: 0.5rem;
				color: var(--text-muted-color);
			}
		</style>
	</head>
	<body class="antialiased theme-indigo">
		<div class="container mx-auto p-4 md:p-6 max-w-screen-2xl">
			<header class="text-center mb-8 relative">
				<h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text" style="background-image: linear-gradient(to right, var(--primary-color-start), var(--primary-color-end));">Layout Analyzer Pro</h1>
				<p class="text-md text-gray-600 dark:text-gray-400 mt-2">The definitive utility for deep layout analysis and documentation.</p>
				<div class="absolute top-0 right-0 flex items-center space-x-2">
					<button id="start-again-btn" class="flex items-center space-x-2 px-3 py-2 text-sm rounded-lg text-gray-600 dark:text-gray-300 bg-gray-100 hover:bg-gray-200 dark:bg-slate-700 dark:hover:bg-slate-600" title="Start Again">
						<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h5M20 20v-5h-5M4 4l16 16"/>
						</svg>
						<span>Start Over</span>
					</button>
					<div class="relative inline-block text-left" style="z-index: 50;">
						<button id="theme-menu-btn" class="p-2 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" title="Change Theme">
							<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2m-4-2h4m-4 2h4m-4 4h4m-4 2h4"/>
							</svg>
						</button>
						<div id="theme-menu" class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-slate-800 ring-1 ring-black ring-opacity-5 divide-y divide-gray-100 dark:divide-gray-700 focus:outline-none hidden" role="menu" aria-orientation="vertical" aria-labelledby="theme-menu-btn">
							<div class="py-1" role="none">
								<button class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 flex items-center space-x-2" role="menuitem" data-theme="indigo">
									<span class="w-4 h-4 rounded-full bg-indigo-500"></span>
									<span>Indigo (Default)</span>
								</button>
								<button class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 flex items-center space-x-2" role="menuitem" data-theme="emerald">
									<span class="w-4 h-4 rounded-full bg-emerald-500"></span>
									<span>Emerald</span>
								</button>
								<button class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 flex items-center space-x-2" role="menuitem" data-theme="rose">
									<span class="w-4 h-4 rounded-full bg-rose-500"></span>
									<span>Rose</span>
								</button>
							</div>
							<div class="py-1" role="none">
								<button class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700" role="menuitem" data-theme-mode="light">
									<span>Light Mode</span>
								</button>
								<button class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700" role="menuitem" data-theme-mode="dark">
									<span>Dark Mode</span>
								</button>
							</div>
						</div>
					</div>
				</div>
			</header>
			<div id="progress-container" class="mb-8 hidden">
				<div class="flex justify-between mb-1">
					<span id="progress-text" class="text-base font-medium text-blue-700 dark:text-blue-400"></span>
					<span id="progress-percent" class="text-sm font-medium text-blue-700 dark:text-blue-400"></span>
				</div>
				<div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
					<div id="progress-bar" class="progress-bar h-2.5 rounded-full"></div>
				</div>
			</div>
			<div id="error-container" class="my-4"></div>
			<main id="main-content" class="space-y-8"></main>
		</div>
		<button id="back-to-top" class="p-3 rounded-full btn-secondary text-white shadow-lg btn hover:bg-blue-700" title="Back to Top">
			<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
			</svg>
		</button>

		<script>
			/* -----------------------------------------
			   Templates & Icons
			------------------------------------------*/
			const ICONS = {
				upload: `<svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>`,
				spinner: `<svg class="animate-spin h-12 w-12 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/></svg>`,
				success: `<svg class="w-12 h-12 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`,
			};

			const TEMPLATES = {
				step1: `<h2 class="text-xl font-bold mb-4 border-b pb-3 border-gray-200 dark:border-gray-700">Step 1: Enter Layout ID(s)</h2>
            <p class="text-gray-600 dark:text-gray-400 mb-4" role="note">Enter the numeric CRMNext Layout ID for each layout you want to analyze, separated by commas.</p>
            <div class="flex items-center space-x-4" role="group" aria-labelledby="step1-title">
                <input id="layout-id-input" placeholder="e.g., 317492, 317493" class="flex-grow p-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-transparent" aria-label="Enter layout IDs">
                <button id="generate-query-btn" class="px-6 py-2.5 text-white font-semibold rounded-lg shadow-md btn" disabled aria-label="Generate Query">Generate Query</button>
            </div>`,

				step2: `<h2 class="text-xl font-bold mb-4 border-b pb-3 border-gray-200 dark:border-gray-700">Step 2: Fetch and Analyze Data</h2>
            <p class="text-gray-600 dark:text-gray-400 mb-4" role="note">First, run this query on your database and copy the resulting XML. Then, paste it or upload the file into the box below and click 'Analyze'.</p>
            <div class="sql-container flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4 mb-6">
                <input type="text" readonly class="sql-box p-2 rounded-md w-full border border-gray-300 dark:border-gray-600 truncate text-sm" id="sql-output" aria-readonly="true" aria-label="Generated SQL Query"/>
                <button class="copy-btn flex-shrink-0 px-4 py-2 text-white font-semibold rounded-lg shadow-md btn" aria-label="Copy SQL Query">Copy SQL</button>
            </div>
            <div class="text-center" role="group" aria-labelledby="step2-title">
                <textarea id="xml-input" class="w-full h-48 p-2 mb-4 border border-gray-300 dark:border-gray-600 rounded-md bg-transparent resize-y" placeholder="Paste your XML data here..." aria-label="Paste XML data"></textarea>
                <div class="flex items-center space-x-4 my-4">
                    <hr class="flex-grow border-t border-gray-300 dark:border-gray-700" aria-hidden="true">
                    <span class="text-sm font-semibold text-gray-500 dark:text-gray-400">OR</span>
                    <hr class="flex-grow border-t border-gray-300 dark:border-gray-700" aria-hidden="true">
                </div>
                <div class="file-drop-zone rounded-lg p-6 text-center cursor-pointer mb-4" id="file-drop-zone" role="button" tabindex="0">
                    <input type="file" class="hidden" accept=".xml" id="file-input" aria-label="Upload XML file"/>
                    <div class="flex justify-center items-center text-gray-400" id="drop-icon">${ICONS.upload}</div>
                    <h3 class="font-semibold mt-2">Upload XML File</h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Click or drop <code>Combined_Data.xml</code> here</p>
                </div>
                <button id="analyze-xml-btn" class="px-6 py-2.5 text-white font-semibold rounded-lg shadow-md btn-secondary" disabled aria-label="Analyze XML Data">Analyze XML</button>
            </div>`,

				finalAnimation: `<div id="final-step-animation" class="final-animation text-center py-10">
                        <div class="inline-block bg-emerald-500 p-4 rounded-full shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        </div>
                        <p class="mt-4 text-xl font-semibold">Analysis Complete! Generating Report...</p>
                    </div>`,

				results: `<div id="step-results-container">
				<div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">Analysis Report</h2>
                <div class="flex items-center space-x-3 mt-4 md:mt-0">
                    <button id="download-csv-btn" class="px-5 py-2.5 text-white font-semibold rounded-lg shadow-md btn-secondary" aria-label="Download Report as CSV">Download CSV</button>
                    <button id="download-excel-btn" class="px-5 py-2.5 text-white font-semibold rounded-lg shadow-md btn-secondary" aria-label="Download Report as Excel">Download Excel</button>
                </div>
            </div>
            <div id="dashboard" class="mb-8" aria-live="polite"></div>
            <div id="filter-bar" class="bg-gray-100 dark:bg-slate-800 p-4 rounded-lg mb-6 border border-gray-200 dark:border-gray-700 flex flex-wrap items-center gap-4"></div>
            <div class="table-container" role="region" aria-labelledby="results-table-title" tabindex="0">
                <h3 id="results-table-title" class="sr-only">Analysis Results Table</h3>
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-slate-800">
                        <tr>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider align-bottom pinned-col pinned-col-1" style="min-width: 200px;">Layout Label</th>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider align-bottom pinned-col pinned-col-2" style="min-width: 200px;">DB Field Label</th>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider align-bottom">Field ID</th>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider align-bottom">Layout State ID</th>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider align-bottom">Layout State Name</th>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider align-bottom">Data Type</th>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider align-bottom">Default Value</th>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider align-bottom">Length</th>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider align-bottom">Column Name</th>
                            <th scope="col" colspan="3" class="px-2 py-2 text-center text-xs font-semibold uppercase tracking-wider border-b border-l border-r border-gray-200 dark:border-gray-700">
                                <div class="tooltip" role="tooltip" aria-describedby="tooltip-new-edit">New / Edit<span class="tooltiptext" id="tooltip-new-edit">Properties on the data entry / creation form.</span>
                                </div>
                            </th>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-center text-xs font-semibold uppercase tracking-wider border-b border-r border-gray-200 dark:border-gray-700">
                                <div class="tooltip" role="tooltip" aria-describedby="tooltip-detail">Detail Status<span class="tooltiptext" id="tooltip-detail">H = Hidden, D = Displayed</span>
                                </div>
                            </th>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-center text-xs font-semibold uppercase tracking-wider border-b border-r border-gray-200 dark:border-gray-700">
                                <div class="tooltip" role="tooltip" aria-describedby="tooltip-history">History Status<span class="tooltiptext" id="tooltip-history">H = Hidden, D = Displayed</span>
                                </div>
                            </th>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider align-bottom">LOVs</th>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider align-bottom">Dependency Condition</th>
                        </tr>
                        <tr>
                            <th scope="col" class="px-2 py-2 text-center text-xs font-semibold uppercase tracking-wider border-l border-gray-200 dark:border-gray-700">
                                <div class="tooltip" role="tooltip" aria-describedby="tooltip-req">Req?<span class="tooltiptext" id="tooltip-req">Is the field Required?</span>
                                </div>
                            </th>
                            <th scope="col" class="px-2 py-2 text-center text-xs font-semibold uppercase tracking-wider">
                                <div class="tooltip" role="tooltip" aria-describedby="tooltip-ro">RO?<span class="tooltiptext" id="tooltip-ro">Is the field Read-Only?</span>
                                </div>
                            </th>
                            <th scope="col" class="px-2 py-2 text-center text-xs font-semibold uppercase tracking-wider border-r border-gray-200 dark:border-gray-700">
                                <div class="tooltip" role="tooltip" aria-describedby="tooltip-hid">Hid?<span class="tooltiptext" id="tooltip-hid">Is the field Hidden?</span>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="results-table-body" class="bg-white dark:bg-slate-900 divide-y divide-gray-200 dark:divide-gray-700"></tbody>
                </table>
            </div>
            <p id="perf-metrics" class="text-xs text-center mt-4 text-gray-500 dark:text-gray-400" aria-live="polite"></p>
			</div>`
			};

			/* -----------------------------------------
			   UI helpers
			------------------------------------------*/
			const UI = {
				mainContainer: document.getElementById('main-content'),
				errorContainer: document.getElementById('error-container'),
				progressContainer: document.getElementById('progress-container'),
				progressBar: document.getElementById('progress-bar'),
				progressText: document.getElementById('progress-text'),
				progressPercent: document.getElementById('progress-percent'),

				createStep(content) {
					const card = document.createElement('section');
					card.className = 'step-card p-6';
					card.innerHTML = content;
					this.mainContainer.appendChild(card);
					setTimeout(() => card.classList.add('is-visible'), 50);
					return card;
				},

				renderError(message) {
					this.errorContainer.innerHTML = `<div class="step-card is-visible p-4 border-l-4 border-red-500 bg-red-50 dark:bg-red-900/20" role="alert" aria-live="assertive">
                                        <div class="flex">
                                            <div class="flex-shrink-0">
                                                <svg class="h-5 w-5 text-red-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                                </svg>
                                            </div>
                                            <div class="ml-3">
                                                <p class="text-sm text-red-700 dark:text-red-300">${this.escapeHtml(message)}</p>
                                            </div>
                                        </div>
                                    </div>`;
				},

				clearErrors() {
					this.errorContainer.innerHTML = '';
				},

				updateProgress(step, totalSteps, text) {
					this.progressContainer.classList.remove('hidden');
					const percent = Math.round((step / totalSteps) * 100);
					this.progressBar.style.width = `${percent}%`;
					this.progressText.textContent = `Step ${step} of ${totalSteps}: ${text}`;
					this.progressPercent.textContent = `${percent}%`;
				},

				updateFileDropzone(dropzone, state, fileName = '') {
					const iconContainer = dropzone.querySelector('#drop-icon');
					const textContainer = dropzone.querySelector('p');

					dropzone.classList.remove('is-loading', 'has-file');

					if (state === 'loading') {
						iconContainer.innerHTML = ICONS.spinner;
						textContainer.textContent = 'Processing...';
						dropzone.classList.add('is-loading');
					} else if (state === 'success') {
						iconContainer.innerHTML = ICONS.success;
						textContainer.textContent = fileName;
						dropzone.classList.add('has-file');
					} else { // 'initial'
						iconContainer.innerHTML = ICONS.upload;
						textContainer.textContent = 'Click or drop Combined_Data.xml here';
					}
				},

				copyToClipboard(text, buttonElement) {
					if (navigator.clipboard && navigator.clipboard.writeText) {
						navigator.clipboard.writeText(text).then(() => {
							const original = buttonElement.textContent;
							buttonElement.textContent = 'Copied!';
							setTimeout(() => buttonElement.textContent = original, 2000);
						}).catch(err => UI.renderError('Failed to copy text: ' + err));
						return;
					}
					const textArea = document.createElement('textarea');
					textArea.value = text;
					textArea.style.position = "fixed";
					textArea.style.top = "-9999px";
					document.body.appendChild(textArea);
					textArea.focus();
					textArea.select();
					try {
						const successful = document.execCommand('copy');
						if (successful) {
							const originalText = buttonElement.textContent;
							buttonElement.textContent = 'Copied!';
							setTimeout(() => {
								buttonElement.textContent = originalText;
							}, 2000);
						} else {
							UI.renderError('Failed to copy text.');
						}
					} catch (err) {
						UI.renderError('Failed to copy text: ' + err);
					}
					document.body.removeChild(textArea);
				},

				showFinalAnimation(callback) {
					const animationEl = UI.createStep(TEMPLATES.finalAnimation);
					setTimeout(() => {
						animationEl.remove();
						callback();
					}, 1500);
				},

				escapeHtml(text) {
					if (text === null || text === undefined) return '';
					const div = document.createElement('div');
					div.textContent = text;
					return div.innerHTML;
				},

				renderResults(data, allData) {
					// Clear any existing report cards
					document.querySelectorAll('#main-content .step-card').forEach(card => card.remove());
					
					let resultsCard = document.createElement('section');
					resultsCard.className = 'step-card p-6';
					resultsCard.id = 'step-results'; // Add an ID for easy lookup
					resultsCard.innerHTML = TEMPLATES.results;
					UI.mainContainer.appendChild(resultsCard);
					setTimeout(() => resultsCard.classList.add('is-visible'), 50);

					UI.renderDashboard(resultsCard.querySelector('#dashboard'), App.state);
					UI.renderFilters(resultsCard.querySelector('#filter-bar'), allData, () => App.handleFilterChange());
					resultsCard.querySelector('#download-csv-btn').addEventListener('click', () => Exporter.download('csv'));
					resultsCard.querySelector('#download-excel-btn').addEventListener('click', () => Exporter.download('excel'));


					const tableBody = resultsCard.querySelector('#results-table-body');
					if (!tableBody) {
						UI.renderError('Results table body not found');
						return;
					}
					tableBody.innerHTML = '';

					if (data.length === 0) {
						tableBody.innerHTML = `<tr>
                                        <td colspan="16" class="text-center py-10 text-gray-500 dark:text-gray-400">No fields match the current filters.</td>
                                    </tr>`;
						return;
					}

					const groupedData = data.reduce((acc, item) => {
						const sectionKey = `${item.section || 'Uncategorized'}-${item.layoutStateID}`;
						(acc[sectionKey] = acc[sectionKey] || []).push(item);
						return acc;
					}, {});

					Object.keys(groupedData).sort().forEach(sectionKey => {
						const [section, stateId] = sectionKey.split('-');
						const headerRow = document.createElement('tr');
						headerRow.className = "section-header";
						headerRow.id = `section-header-${sectionKey.replace(/\s+/g, '-')}`;
						headerRow.innerHTML = `<th colspan="16" class="px-4 py-2 text-left text-sm font-bold">${this.escapeHtml(section)} (State ID: ${this.escapeHtml(stateId)})</th>`;
						tableBody.appendChild(headerRow);

						groupedData[sectionKey].forEach(item => {
							const row = document.createElement('tr');
							row.className = `hover:bg-gray-50 dark:hover:bg-slate-800`;

							const NA = {
								isRequired: '-',
								isReadOnly: '-',
								isHidden: '-'
							};
							const newEdit = item.layouts.newEdit || NA;
							const detail = item.layouts.detail;
							const history = item.layouts.history;
							const db = item.dbInfo || {};

							let defaultValues = [];
							if (item.layoutDefaultValue) defaultValues.push(`Layout: ${this.escapeHtml(item.layoutDefaultValue)}`);
							if (db.DefaultValue) defaultValues.push(`Field: ${this.escapeHtml(db.DefaultValue)}`);
							const combinedDefaultValue = defaultValues.length > 0 ? defaultValues.join(', ') : '-';

							let combinedLovs = '-';
							if (item.lovs.layout && item.lovs.layout.length > 0) {
								combinedLovs = item.lovs.layout.join(' | ');
							} else if (item.lovs.database && item.lovs.database.length > 0) {
								combinedLovs = item.lovs.database.join(' | ');
							}

							let detailStatus = 'N/A';
							if (detail) {
								detailStatus = detail.isHidden === 'Yes' ? 'H' : 'D';
							}

							let historyStatus = 'N/A';
							if (history) {
								historyStatus = history.isHidden === 'Yes' ? 'H' : 'D';
							}

							row.innerHTML = `
                    <td class="px-4 py-3 text-sm font-medium pinned-col pinned-col-1" style="padding-left: ${item.depth > 0 ? 0.75 + item.depth * 1.5 : 0.75}rem">${item.depth > 0 ? '└─ ' : ''}${this.escapeHtml(item.layoutLabel || item.originalId)}</td>
                    <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400 pinned-col pinned-col-2">${this.escapeHtml(db.Label || '-')}</td>
                    <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">${this.escapeHtml(item.fieldId)}</td>
                    <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">${this.escapeHtml(item.layoutStateID || '-')}</td>
                    <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">${this.escapeHtml(item.layoutStateName || '-')}</td>
                    <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">${this.escapeHtml(db.FieldType || 'N/A')}</td>
                    <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">${combinedDefaultValue}</td>
                    <td class="px-4 py-3 text-sm text-center text-gray-500 dark:text-gray-400">${this.escapeHtml(db.Length || '-')}</td>
                    <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">${this.escapeHtml(db.ColumnName || 'N/A')}</td>
                    <td class="px-2 py-3 text-center text-sm border-l border-gray-200 dark:border-gray-700">${this.escapeHtml(newEdit.isRequired)}</td>
                    <td class="px-2 py-3 text-center text-sm">${this.escapeHtml(newEdit.isReadOnly)}</td>
                    <td class="px-2 py-3 text-center text-sm border-r border-gray-200 dark:border-gray-700">${this.escapeHtml(newEdit.isHidden)}</td>
                    <td class="px-4 py-3 text-center text-sm border-l border-r border-gray-200 dark:border-gray-700">${this.escapeHtml(detailStatus)}</td>
                    <td class="px-4 py-3 text-center text-sm border-r border-gray-200 dark:border-gray-700">${this.escapeHtml(historyStatus)}</td>
                    <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400 border-l border-r border-gray-200 dark:border-gray-700">${this.escapeHtml(combinedLovs)}</td>
                    <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400 border-r border-gray-200 dark:border-gray-700">${this.escapeHtml(item.dependencyCondition || (item._isChild ? 'Child field (orphaned/parent may be in other state)' : '-'))}</td>`;
							tableBody.appendChild(row);
						});
					});

					// Scroll to the new report
					resultsCard.scrollIntoView({
						behavior: 'smooth'
					});
				},

				renderDashboard(container, state) {
					const createStatCard = (label, value) => `<div class="p-4 bg-slate-100 dark:bg-slate-800 rounded-lg text-center" aria-live="polite">
                                        <p class="text-2xl font-bold text-blue-600 dark:text-blue-400" data-countup="${value}">0</p>
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">${label}</p>
                                    </div>`;
					const sectionsData = state.finalData.reduce((acc, item) => {
						const section = item.section || 'Uncategorized';
						acc[section] = (acc[section] || 0) + 1;
						return acc;
					}, {});
					const maxSectionCount = Math.max(...Object.values(sectionsData), 1);
					const chartHTML = Object.entries(sectionsData).sort((a, b) => b[1] - a[1]).slice(0, 5).map(([name, count]) => `
            <a href="#" class="section-jump flex items-center text-sm group" data-section-name="${encodeURIComponent(name)}" aria-label="Jump to ${name} section">
                                        <div class="w-1/3 text-gray-600 dark:text-gray-400 truncate pr-2 group-hover:text-blue-600 dark:group-hover:text-blue-400">${name}</div>
                                        <div class="w-2/3 bg-gray-200 dark:bg-gray-700 rounded-full h-4">
                                            <div class="chart-bar h-4 rounded-full flex items-center justify-end pr-2 text-white font-bold text-xs group-hover:opacity-80" style="width: ${(count/maxSectionCount)*100}%">${count}</div>
                                        </div>
                                    </a>
        `).join('');

					container.innerHTML = `
            <div class="grid grid-cols-1 gap-8">
                <div>
                    <h3 class="text-lg font-bold mb-3">Key Statistics</h3>
                    <div id="stats-card" class="grid grid-cols-2 md:grid-cols-4 gap-4" role="region" aria-label="Key Statistics">
                        ${createStatCard('Total Fields', state.finalData.length)}
                        ${createStatCard('Custom Fields', state.finalData.filter(f => String(f.originalId || '').startsWith('cust_')).length)}
                        ${createStatCard('Custom Buttons', state.buttons.size)}
                        ${createStatCard('UI Cards', state.cards.size)}
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-3">Top 5 Sections by Field Count</h3>
                    <div id="section-chart" class="space-y-2" role="list">
                        ${chartHTML}
                    </div>
                </div>
            </div>`;

					container.querySelectorAll('[data-countup]').forEach(el => this.countUp(el));
					setTimeout(() => {
						container.querySelectorAll('.chart-bar').forEach(el => { /* width set inline */ });
					}, 100);

					container.querySelectorAll('.section-jump').forEach(link => {
						link.addEventListener('click', (e) => {
							e.preventDefault();
							const name = decodeURIComponent(link.dataset.sectionName);
							const possibleHeaders = document.querySelectorAll('[id^="section-header-"]');
							let found = null;
							possibleHeaders.forEach(h => {
								if (!found && h.textContent.trim().startsWith(name)) found = h;
							});
							if (found) found.scrollIntoView({
								behavior: 'smooth',
								block: 'center'
							});
							else UI.renderError('Section header not found: ' + name);
						});
					});
				},

				countUp(el) {
					const endValue = parseInt(el.dataset.countup, 10);
					if (isNaN(endValue)) return;
					let start = 0;
					const duration = 1500;
					const stepTime = Math.max(1, Math.abs(Math.floor(duration / endValue)));
					const timer = setInterval(() => {
						start += 1;
						el.textContent = start;
						if (start >= endValue) {
							el.textContent = endValue;
							clearInterval(timer);
						}
					}, stepTime);
				},

				renderFilters(container, data, changeCallback) {
					const sections = [...new Set(data.map(item => item.section))].sort();
					container.innerHTML = `<span class="font-semibold text-sm self-center">Filters:</span>`;
					let options = '<option value="">All Sections</option>' + sections.map(s => `<option value="${s}">${s}</option>`).join('');
					container.innerHTML += `<div>
                                    <label class="sr-only" for="filter-section">Section</label>
                                    <select id="filter-section" class="p-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-transparent" aria-label="Filter by section">${options}</select>
                                </div>`;
					container.innerHTML += `<div>
                                    <label class="sr-only" for="filter-type">Field Type</label>
                                    <select id="filter-type" class="p-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-transparent" aria-label="Filter by field type">
                                        <option value="">All Types</option>
                                        <option value="custom">Custom</option>
                                        <option value="system">System</option>
                                    </select>
                                </div>`;
					container.innerHTML += `<div>
                                    <label class="sr-only" for="filter-mandatory">Requirement</label>
                                    <select id="filter-mandatory" class="p-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-transparent" aria-label="Filter by required fields">
                                        <option value="">All Requirements</option>
                                        <option value="yes">Mandatory Only</option>
                                    </select>
                                </div>`;
					container.querySelectorAll('select, input').forEach(el => el.addEventListener('input', changeCallback));
				}
			};

			/* -----------------------------------------
			   App
			------------------------------------------*/
			const App = {
				state: {
					layoutIds: [],
					masterFieldMap: new Map(),
					finalData: [],
					filteredData: [],
					uiTabs: null,
					cards: new Map(),
					buttons: new Map(),
					profileMapping: new Map(),
					parseTime: 0
				},

				init() {
					this.reset();
					DarkMode.init();
					BackToTop.init();
					document.getElementById('start-again-btn').addEventListener('click', () => this.reset());
				},

				reset() {
					this.state = {
						layoutIds: [],
						masterFieldMap: new Map(),
						finalData: [],
						filteredData: [],
						uiTabs: null,
						cards: new Map(),
						buttons: new Map(),
						profileMapping: new Map(),
						parseTime: 0
					};
					UI.mainContainer.innerHTML = '';
					UI.progressContainer.classList.add('hidden');
					UI.clearErrors();
					this.renderStep1();
				},

				renderStep1() {
					UI.updateProgress(1, 2, 'Awaiting Layout IDs');
					const card = UI.createStep(TEMPLATES.step1);
					const input = card.querySelector('#layout-id-input');
					const button = card.querySelector('#generate-query-btn');

					const updateButtonState = () => {
						button.disabled = input.value.trim() === '';
					};

					input.addEventListener('input', updateButtonState);
					input.addEventListener('keydown', (e) => {
						if (e.key === 'Enter') {
							e.preventDefault();
							if (!button.disabled) {
								this.handleLayoutQuery(input.value);
							}
						}
					});
					button.addEventListener('click', () => this.handleLayoutQuery(input.value));
				},

				handleLayoutQuery(idValue) {
					UI.clearErrors();
					this.state.layoutIds = idValue.trim().split(',').map(id => id.trim()).filter(id => id);
					if (this.state.layoutIds.length === 0) {
						UI.renderError("Please enter at least one valid Layout ID.");
						return;
					}

					UI.updateProgress(1, 2, 'Generating Combined Query');
					const card = UI.createStep(TEMPLATES.step2);
					const sqlQuery = SQLGenerator.combinedQuery(this.state.layoutIds.join(',')).replace(/\s\s+/g, ' ').trim();
					card.querySelector('#sql-output').value = sqlQuery;
					const copyBtn = card.querySelector('.copy-btn');
					copyBtn.addEventListener('click', () => {
						UI.copyToClipboard(sqlQuery, copyBtn);
					});

					const xmlInput = card.querySelector('#xml-input');
					const analyzeBtn = card.querySelector('#analyze-xml-btn');
					const dropzone = card.querySelector('#file-drop-zone');
					const fileInput = card.querySelector('#file-input');

					const updateAnalyzeButtonState = () => {
						analyzeBtn.disabled = xmlInput.value.trim() === '';
					};

					xmlInput.addEventListener('input', updateAnalyzeButtonState);
					xmlInput.addEventListener('keydown', (e) => {
						if (e.key === 'Enter' && !e.shiftKey) {
							e.preventDefault();
							if (!analyzeBtn.disabled) {
								this.handleCombinedXml(xmlInput.value);
							}
						}
					});

					analyzeBtn.addEventListener('click', () => {
						const xmlContent = xmlInput.value.trim();
						if (xmlContent) {
							this.handleCombinedXml(xmlContent);
						} else {
							UI.renderError("Please paste or upload XML data before analyzing.");
						}
					});

					this.setupFileHandler(dropzone, fileInput, async (file) => {
						UI.updateFileDropzone(dropzone, 'loading');
						try {
							const text = await file.text();
							xmlInput.value = text;
							UI.updateFileDropzone(dropzone, 'success', file.name);
							updateAnalyzeButtonState();
						} catch (e) {
							UI.renderError('Failed to read file: ' + e.message);
							UI.updateFileDropzone(dropzone, 'initial');
						}
					});

					fileInput.addEventListener('change', () => {
						if (fileInput.files.length > 0) {
							updateAnalyzeButtonState();
						}
					});
				},

				async handleCombinedXml(xmlString) {
					UI.clearErrors();

					UI.updateProgress(1, 2, 'Analyzing XML...');

					const existingReport = document.getElementById('step-results');
					if (existingReport) {
						existingReport.remove();
					}

					const startTime = performance.now();
					try {
						const parsedResult = await ParserWorker.run('parseCombined', xmlString);
						const endTime = performance.now();
						this.state.parseTime = ((endTime - startTime) / 1000).toFixed(2);

						this.state.masterFieldMap = parsedResult.masterFieldMap;
						this.state.uiTabs = parsedResult.uiTabs || parsedResult.profileMapping;
						this.state.cards = parsedResult.cards;
						this.state.buttons = parsedResult.buttons;
						this.state.profileMapping = parsedResult.profileMapping || parsedResult.uiTabs;

						this.finalizeData(parsedResult.dbData);

						UI.updateProgress(2, 2, 'Analysis Complete!');

						UI.showFinalAnimation(() => {
							this.renderInitialReport();
							const perfEl = document.getElementById('perf-metrics');
							if (perfEl) perfEl.textContent = `Parsed XML and rendered report in ${this.state.parseTime} seconds.`;
						});

					} catch (error) {
						this.handleError(error, 2);
						UI.updateProgress(1, 2, 'Awaiting XML data');
					}
				},

				finalizeData(dbData) {
					this.state.masterFieldMap.forEach((field) => {
						if (dbData && dbData.has(String(field.fieldId))) field.dbInfo = dbData.get(String(field.fieldId));
						if (!field.lovs) field.lovs = {
							database: null,
							layout: null,
							dependency: null
						};
						if (field.dbInfo?.LOVS) field.lovs.database = Array.isArray(field.dbInfo.LOVS) ? field.dbInfo.LOVS : String(field.dbInfo.LOVS).split(/,\s*/);
						if (field.visibilityOptions) field.lovs.layout = Array.isArray(field.visibilityOptions) ? field.visibilityOptions : String(field.visibilityOptions).split(/,\s*/);
						if (field.dependencies && field.dependencies.length > 0) {
							field.lovs.dependency = Array.from(new Set(field.dependencies.map(d => d.onValue)));
						}
					});

					const finalData = [];
					const processed = new Set();
					const childOriginalIds = new Set();

					this.state.masterFieldMap.forEach(field => {
						(field.dependencies || []).forEach(dep => (dep.childFields || []).forEach(childId => {
							if (childId) childOriginalIds.add(childId);
						}));
					});

					const processField = (field, depth = 0) => {
						const uniqueFieldKey = `${field.fieldId}-${field.layoutStateID}`;
						if (!field || processed.has(uniqueFieldKey)) return;
						processed.add(uniqueFieldKey);
						field.depth = depth;
						finalData.push(field);

						(field.dependencies || []).forEach(dep => {
							const layoutContext = Array.from(new Set(field.dependencyContexts || [])).join(', ');
							(dep.childFields || []).forEach(childOriginalId => {
								const childId = childOriginalId && String(childOriginalId).startsWith('cust_') ? childOriginalId.replace('cust_', '') : childOriginalId;
								const childFieldKey = `${childId}-${field.layoutStateID}`;

								if (this.state.masterFieldMap.has(childFieldKey)) {
									const childField = this.state.masterFieldMap.get(childFieldKey);
									childField.dependencyCondition = `On '${field.layoutLabel}' = '${dep.onValue}'${layoutContext ? ' ('+layoutContext+')' : ''}`;
									if (!processed.has(childFieldKey)) processField(childField, depth + 1);
								} else {
									for (const [k, f] of this.state.masterFieldMap.entries()) {
										if (f.originalId === childOriginalId || f.originalId === ('cust_'+childOriginalId) || ('cust_'+f.originalId) === childOriginalId) {
											f.dependencyCondition = `On '${field.layoutLabel}' = '${dep.onValue}'${layoutContext ? ' ('+layoutContext+')' : ''}`;
											if (!processed.has(k)) processField(f, depth + 1);
											break;
										}
									}
								}
							});
						});
					};

					this.state.masterFieldMap.forEach(field => {
						processField(field);
					});

					this.state.finalData = finalData;
					this.state.filteredData = finalData;
				},

				renderInitialReport() {
					UI.renderResults(this.state.finalData, this.state.finalData);
				},

				handleFilterChange() {
					const sectionEl = document.getElementById('filter-section');
					const typeEl = document.getElementById('filter-type');
					const mandatoryEl = document.getElementById('filter-mandatory');

					const filters = {
						section: sectionEl ? sectionEl.value : '',
						type: typeEl ? typeEl.value : '',
						mandatory: mandatoryEl ? mandatoryEl.value : '',
					};

					this.state.filteredData = this.state.finalData.filter(item => {
						const sectionMatch = !filters.section || item.section === filters.section;
						const typeMatch = !filters.type || (filters.type === 'custom' ? String(item.originalId || '').startsWith('cust_') : !String(item.originalId || '').startsWith('cust_'));
						const mandatoryMatch = !filters.mandatory || (item.layouts.newEdit?.isRequired === 'Yes');
						return sectionMatch && typeMatch && mandatoryMatch;
					});

					UI.renderResults(this.state.filteredData, this.state.finalData);
				},

				handleError(error, step) {
					UI.renderError(`An error occurred at Step ${step}: ${error.message}`);
					console.error(error);
				},

				setupFileHandler(dropzone, input, callback) {
					dropzone.addEventListener('click', () => input.click());
					dropzone.addEventListener('keydown', (e) => {
						if (e.key === 'Enter' || e.key === ' ') {
							e.preventDefault();
							input.click();
						}
					});
					input.addEventListener('change', e => e.target.files[0] && callback.call(this, e.target.files[0]));
					dropzone.addEventListener('dragover', e => {
						e.preventDefault();
						dropzone.classList.add('dragover');
					});
					dropzone.addEventListener('dragleave', e => {
						e.preventDefault();
						dropzone.classList.remove('dragover');
					});
					dropzone.addEventListener('drop', e => {
						e.preventDefault();
						dropzone.classList.remove('dragover');
						e.dataTransfer.files[0] && callback.call(this, e.dataTransfer.files[0]);
					});
				}
			};

			/* -----------------------------------------
			   SQL Generator
			------------------------------------------*/
			const SQLGenerator = {
				combinedQuery(ids) {
					return `-- Set your comma-separated Layout IDs here.
DECLARE @LayoutIDs NVARCHAR(MAX) = '${ids}';

DECLARE @LayoutXML XML;
DECLARE @FieldXML XML;
DECLARE @CardXML XML;
DECLARE @CustomFieldIDs TABLE (FieldID INT PRIMARY KEY);
DECLARE @CardIDs TABLE (CardID INT PRIMARY KEY);
DECLARE @RawEncodedXML NVARCHAR(MAX);
DECLARE @RawDetailXML NVARCHAR(MAX);

-- Step 1: Get Raw HTML-encoded LayoutXML from a primary New/Edit layout to find field IDs.
SELECT @RawEncodedXML = CAST(LayoutXML AS NVARCHAR(MAX))
FROM LayoutGroupView
WHERE LayoutID IN (
    SELECT T.c.value('.', 'INT')
    FROM (SELECT CAST('<ID>' + REPLACE(@LayoutIDs, ',', '</ID>
										<ID>') + '</ID>' AS XML)) AS A(B)
    CROSS APPLY A.B.nodes('/ID') AS T(c)
) AND LayoutType = 1;

-- Step 1B: Get Raw HTML-encoded DetailLayout XML (for CardView extraction).
SELECT @RawDetailXML = CAST(LayoutXML AS NVARCHAR(MAX))
FROM LayoutGroupView
WHERE LayoutID IN (
    SELECT T.c.value('.', 'INT')
    FROM (SELECT CAST('<ID>' + REPLACE(@LayoutIDs, ',', '</ID>
										<ID>') + '</ID>' AS XML)) AS A(B)
    CROSS APPLY A.B.nodes('/ID') AS T(c)
) AND LayoutType = 2;

-- Step 2: Manually decode the HTML-encoded XML to prepare for parsing.
DECLARE @DecodedLayoutXML XML;
DECLARE @DecodedDetailXML XML;
DECLARE @TempWrapper XML;

-- decode New/Edit
SET @TempWrapper = CAST('<root>' + @RawEncodedXML + '</root>' AS XML);
SET @DecodedLayoutXML = @TempWrapper.query('/root/*');

-- decode Detail
SET @TempWrapper = CAST('<root>' + @RawDetailXML + '</root>' AS XML);
SET @DecodedDetailXML = @TempWrapper.query('/root/*');

-- Step 3: Extract all unique custom field IDs (from New/Edit layout).
INSERT INTO @CustomFieldIDs (FieldID)
SELECT DISTINCT
    TRY_CAST(REPLACE(T.c.value('@fieldid', 'NVARCHAR(100)'), 'cust_', '') AS INT)
FROM @DecodedLayoutXML.nodes('//col[@fieldid]') AS T(c)
WHERE T.c.value('@fieldid', 'NVARCHAR(100)') LIKE 'cust_%'
  AND ISNUMERIC(REPLACE(T.c.value('@fieldid', 'NVARCHAR(100)'), 'cust_', '')) = 1;

-- ? FIXED: Extract Card IDs from DETAIL layout
INSERT INTO @CardIDs (CardID)
SELECT DISTINCT T.c.value('@controlid', 'INT')
FROM @DecodedDetailXML.nodes('//control[@name="CardView"]') AS T(c)
WHERE ISNULL(T.c.value('@controlid', 'INT'), 0) <> 0;

-- Step 4: Get the complete, properly-formed Layout XML for all specified layouts, types, and states.
SET @LayoutXML = (
    SELECT
        (SELECT T.StateID AS [@StateID], (
            SELECT LayoutXML
            FROM LayoutGroupView AS LGV
            WHERE LGV.LayoutType = 1
              AND LGV.StateID = T.StateID
              AND LGV.LayoutID IN (
                  SELECT C.value('.', 'INT')
                  FROM (SELECT CAST('<ID>' + REPLACE(@LayoutIDs, ',', '</ID>
											<ID>') + '</ID>' AS XML)) AS A(B)
                  CROSS APPLY A.B.nodes('/ID') AS T(c)
              )
            FOR XML PATH('Layout'), TYPE
        ) AS [Layouts]
        FROM (
            SELECT DISTINCT StateID
            FROM LayoutGroupView
            WHERE LayoutType = 1
              AND LayoutID IN (
                  SELECT C.value('.', 'INT')
                  FROM (SELECT CAST('<ID>' + REPLACE(@LayoutIDs, ',', '</ID>
											<ID>') + '</ID>' AS XML)) AS A(B)
                  CROSS APPLY A.B.nodes('/ID') AS T(c)
              )
        ) AS T
        FOR XML PATH('NewEditLayout'), ROOT('NewEditLayoutsGroup'), TYPE),
        (SELECT T.StateID AS [@StateID], (
            SELECT LayoutXML
            FROM LayoutGroupView AS LGV
            WHERE LGV.LayoutType = 2
              AND LGV.StateID = T.StateID
              AND LGV.LayoutID IN (
                  SELECT C.value('.', 'INT')
                  FROM (SELECT CAST('<ID>' + REPLACE(@LayoutIDs, ',', '</ID>
											<ID>') + '</ID>' AS XML)) AS A(B)
                  CROSS APPLY A.B.nodes('/ID') AS T(c)
              )
            FOR XML PATH('Layout'), TYPE
        ) AS [Layouts]
        FROM (
            SELECT DISTINCT StateID
            FROM LayoutGroupView
            WHERE LayoutType = 2
              AND LayoutID IN (
                  SELECT C.value('.', 'INT')
                  FROM (SELECT CAST('<ID>' + REPLACE(@LayoutIDs, ',', '</ID>
											<ID>') + '</ID>' AS XML)) AS A(B)
                  CROSS APPLY A.B.nodes('/ID') AS T(c)
              )
        ) AS T
        FOR XML PATH('DetailLayout'), ROOT('DetailLayoutsGroup'), TYPE),
        (SELECT T.StateID AS [@StateID], (
            SELECT LayoutXML
            FROM LayoutGroupView AS LGV
            WHERE LGV.LayoutType = 4
              AND LGV.StateID = T.StateID
              AND LGV.LayoutID IN (
                  SELECT C.value('.', 'INT')
                  FROM (SELECT CAST('<ID>' + REPLACE(@LayoutIDs, ',', '</ID>
											<ID>') + '</ID>' AS XML)) AS A(B)
                  CROSS APPLY A.B.nodes('/ID') AS T(c)
              )
        ) AS [Layouts]
        FROM (
            SELECT DISTINCT StateID
            FROM LayoutGroupView
            WHERE LayoutType = 4
              AND LayoutID IN (
                  SELECT C.value('.', 'INT')
                  FROM (SELECT CAST('<ID>' + REPLACE(@LayoutIDs, ',', '</ID>
											<ID>') + '</ID>' AS XML)) AS A(B)
                  CROSS APPLY A.B.nodes('/ID') AS T(c)
              )
        ) AS T
        FOR XML PATH('HistoryLayout'), ROOT('HistoryLayoutsGroup'), TYPE)
    FOR XML PATH('Layouts'), TYPE
);

-- Step 5: Get the Card XML for all cards found in the layouts.
SELECT @CardXML = (
    SELECT C.CardID AS [@CardID], C.CardXML AS [CardXML]
    FROM Cards C
    WHERE C.CardID IN (SELECT CardID FROM @CardIDs)
    FOR XML PATH('Card'), ROOT('Cards')
);

-- Step 6: Get the Field schema XML for all the custom fields found.
WITH FieldSchema AS (
    SELECT CS.FIELDID, CS.LABEL, CS.TYPE, FTC.Caption AS FieldType,
           CS.LENGTH, CS.DEFAULTVALUE, CS.INTERNALLABEL, CS.TABLENAME, CS.FIELDNAME
    FROM CUSTOMFIELDSCHEMA CS
    LEFT JOIN FieldTypeCodeView FTC ON CS.TYPE = FTC.FIELDTYPE
    WHERE CS.FIELDID IN (SELECT FieldID FROM @CustomFieldIDs)
),
LOVData AS (
    SELECT T1.FIELDID,
        STUFF((
            SELECT ', ' + T2.DISPLAYNAME
            FROM CustomFieldLookup T2
            WHERE T2.FIELDID = T1.FIELDID
            FOR XML PATH('')
        ), 1, 2, '') AS LOVS
    FROM CustomFieldLookup T1
    WHERE T1.FIELDID IN (SELECT FieldID FROM @CustomFieldIDs)
    GROUP BY T1.FIELDID
)
SELECT @FieldXML = (
    SELECT FS.FIELDID, FS.LABEL, FS.FieldType, FS.LENGTH, FS.DEFAULTVALUE,
           FS.INTERNALLABEL, FS.TABLENAME, FS.FIELDNAME, LD.LOVS
    FROM FieldSchema FS
    LEFT JOIN LOVData LD ON FS.FIELDID = LD.FIELDID
    FOR XML PATH('Field'), ROOT('Fields')
);

-- Step 7: Combine Layout, Card, and Field XML into a single final output.
SELECT
    @LayoutXML AS [Layouts],
    @CardXML AS [Cards],
    @FieldXML AS [Fields]
FOR XML PATH('FinalOutput'), TYPE;`;
				}
			};

			/* -----------------------------------------
			   ParserWorker
			------------------------------------------*/
			const ParserWorker = {
				run(task, xml) {
					return new Promise((resolve, reject) => {
						try {
							const parser = new DOMParser();
							const doc = parser.parseFromString(xml, "application/xml");
							if (doc.querySelector('parsererror')) {
								throw new Error('XML parsing error. Please ensure the content is valid XML and was copied correctly.');
							}

							if (task === 'parseCombined') {
								const finalOutputNode = doc.querySelector('FinalOutput');
								if (!finalOutputNode) throw new Error('The root <FinalOutput> tag was not found. The SQL query may have failed or produced an unexpected result.');

								const layoutNode = finalOutputNode.querySelector('Layouts');
								const cardNode = finalOutputNode.querySelector('Cards');
								const fieldNode = finalOutputNode.querySelector('Fields');

								if (!layoutNode) throw new Error('Could not find <Layouts> data within <FinalOutput>. Please check the generated XML.');

								const cardData = cardNode ? this._parseCardXml(cardNode) : new Map();
								const layoutData = this._parseLayouts(layoutNode, cardData);
								const dbData = fieldNode ? this._parseDbXml(fieldNode) : new Map();

								const result = {
									masterFieldMap: layoutData.masterFieldMap,
									profileMapping: layoutData.profileMapping,
									cards: layoutData.cards,
									buttons: layoutData.buttons,
									dbData
								};
								resolve(result);
								return;
							}
							reject(new Error('Unknown parser task'));
						} catch (e) {
							reject(e);
						}
					});
				},

				_parseCardXml(doc) {
					const cardMap = new Map();
					doc.querySelectorAll('Card').forEach(cardNode => {
						const cardId = cardNode.getAttribute('CardID');
						const cardXml = cardNode.querySelector('CardXML')?.textContent;
						if (cardId && cardXml) {
							cardMap.set(cardId, cardXml);
						}
					});
					return cardMap;
				},

				_parseDbXml(doc) {
					const data = new Map();
					doc.querySelectorAll('Field').forEach(fieldNode => {
						const id = fieldNode.querySelector('FIELDID')?.textContent;
						if (!id) return;
						const lovsText = fieldNode.querySelector('LOVS')?.textContent?.trim();
						data.set(id, {
							FieldID: id,
							Label: fieldNode.querySelector('LABEL')?.textContent,
							FieldType: fieldNode.querySelector('FieldType')?.textContent,
							Length: fieldNode.querySelector('LENGTH')?.textContent,
							DefaultValue: fieldNode.querySelector('DEFAULTVALUE')?.textContent,
							TableName: fieldNode.querySelector('TABLENAME')?.textContent,
							FieldName: fieldNode.querySelector('FIELDNAME')?.textContent,
							ColumnName: `${fieldNode.querySelector('TABLENAME')?.textContent || ''}.${fieldNode.querySelector('FIELDNAME')?.textContent || ''}`,
							LOVS: lovsText ? lovsText.split(/, ?/) : null
						});
					});
					return data;
				},

				_parseLayouts(doc, cardData) {
					const masterFieldMap = new Map(),
						profileMapping = new Map(),
						cards = new Map(),
						buttons = new Map();
					this._processLayouts(doc, 'NewEditLayoutsGroup > NewEditLayout', 'newEdit', {
						masterFieldMap,
						profileMapping,
						cards,
						buttons
					}, cardData);
					this._processLayouts(doc, 'DetailLayoutsGroup > DetailLayout', 'detail', {
						masterFieldMap,
						profileMapping,
						cards,
						buttons
					}, cardData);
					this._processLayouts(doc, 'HistoryLayoutsGroup > HistoryLayout', 'history', {
						masterFieldMap,
						profileMapping,
						cards,
						buttons
					}, cardData);
					return {
						masterFieldMap,
						profileMapping,
						cards,
						buttons
					};
				},

				_processLayouts(doc, selector, type, dataMaps, cardData) {
					doc.querySelectorAll(selector).forEach(node => {
						const stateID = node.getAttribute('StateID') || node.querySelector('Layout')?.getAttribute('StateID') || '';
						const stateName = node.getAttribute('StateName') || '';
						node.querySelectorAll('Layout > LayoutXML').forEach(xmlNode => {
							if (!xmlNode.textContent) return;
							const innerDoc = new DOMParser().parseFromString(xmlNode.textContent, "application/xml");
							if (innerDoc.querySelector('parsererror')) return;
							const layoutName = innerDoc.documentElement.getAttribute('layoutname') || 'Unknown Layout';
							const groupId = innerDoc.documentElement.getAttribute('groupid') || null;

							if (groupId !== null) {
								const profileName = layoutName.split(':').pop().trim();
								if (profileName) dataMaps.profileMapping.set(groupId, {
									Profile: profileName,
									Type: type,
									GroupID: groupId
								});
							}

							innerDoc.querySelectorAll('control').forEach(ctrl => {
								const prop = ctrl.querySelector('property[name="CardName"]');
								const cardName = prop?.getAttribute('value');
								if (cardName) dataMaps.cards.set(`${layoutName}-${cardName}-${stateID}`, {
									Name: cardName,
									Layout: layoutName,
									StateID: stateID,
									StateName: stateName
								});
							});

							innerDoc.querySelectorAll('button[iscustom="1"]').forEach(btn => {
								dataMaps.buttons.set(btn.getAttribute('id'), {
									ID: btn.getAttribute('id'),
									Caption: btn.getAttribute('caption'),
									Layout: layoutName,
									StateID: stateID,
									StateName: stateName
								});
							});

							innerDoc.querySelectorAll('section').forEach(section => {
								const sectionName = section.querySelector('text > lang')?.getAttribute('text') || 'Unnamed Section';
								this._extractFieldsFromSection(section, sectionName, type, stateID, stateName, dataMaps.masterFieldMap);
							});

							if (type === 'detail') {
								innerDoc.querySelectorAll('control').forEach(cardControl => {
									const controlName = cardControl.getAttribute('name') || '';
									if (controlName.toLowerCase() === 'cardview') {
										const cardId = cardControl.getAttribute('controlid');
										if (cardId && cardData.has(cardId)) {
											const cardXml = cardData.get(cardId);
											const cardDoc = new DOMParser().parseFromString(cardXml, "application/xml");
											const cardLayoutNode = cardDoc.querySelector('cardlayout > layout');
											if (cardLayoutNode) {
												cardLayoutNode.querySelectorAll('section').forEach(cardSection => {
													const cardSectionName = cardSection.querySelector('text > lang')?.getAttribute('text') || 'Unnamed Card Section';
													const fullSectionName = `Card: ${cardId} - ${cardSectionName}`;
													this._extractFieldsFromSection(cardSection, fullSectionName, type, stateID, stateName, dataMaps.masterFieldMap);
												});
											}
										}
									}
								});
							}
						});
					});
				},

				_extractFieldsFromSection(sectionNode, sectionName, layoutType, stateID, stateName, masterFieldMap) {
					sectionNode.querySelectorAll('col').forEach(col => {
						const origId = col.getAttribute('fieldid');
						if (!origId || origId === 'blankcell') return;
						const id = origId.startsWith('cust_') ? origId.replace('cust_', '') : origId;
						const uniqueFieldKey = `${id}-${stateID}`;

						if (!masterFieldMap.has(uniqueFieldKey)) {
							masterFieldMap.set(uniqueFieldKey, {
								fieldId: id,
								layoutLabel: col.querySelector('text > lang')?.getAttribute('text') || col.getAttribute('name') || '',
								section: sectionName,
								originalId: origId,
								layouts: {},
								dependencies: [],
								dependencyContexts: [],
								visibilityOptions: null,
								dbInfo: null,
								layoutDefaultValue: col.getAttribute('defvalue'),
								lovs: {
									database: null,
									layout: null,
									dependency: null
								},
								dependencyCondition: null,
								layoutStateID: stateID,
								layoutStateName: stateName
							});
						}
						const rec = masterFieldMap.get(uniqueFieldKey);
						rec.layoutLabel = col.querySelector('text > lang')?.getAttribute('text') || col.getAttribute('name') || rec.layoutLabel;
						rec.layoutDefaultValue = col.getAttribute('defvalue') || rec.layoutDefaultValue;

						const req = col.getAttribute('req');
						let isReadOnlyText = 'No';
						const readonlyAttr = col.getAttribute('readonly');
						if (readonlyAttr === '1') {
							const readonlyTypeAttr = col.getAttribute('readonlytype');
							if (readonlyTypeAttr === '4') {
								isReadOnlyText = 'Yes (Once Defined)';
							} else {
								isReadOnlyText = 'Yes';
							}
						}
						rec.layouts[layoutType] = {
							isRequired: req === '1' || req === '2' ? 'Yes' : 'No',
							isReadOnly: isReadOnlyText,
							isHidden: col.getAttribute('hide') === '1' ? 'Yes' : 'No'
						};
						const visNode = col.querySelector('visibility > visibilityoption');
						if (visNode) rec.visibilityOptions = visNode.getAttribute('displaynames')?.split(',') || [];
						const depNode = col.querySelector('dependents');
						if (depNode) {
							if (!rec.dependencyContexts.includes(layoutType)) rec.dependencyContexts.push(layoutType);
							depNode.querySelectorAll('option').forEach(opt => {
								const onValue = opt.getAttribute('name');
								const childFields = Array.from(opt.querySelectorAll('dependent')).map(dep => dep.getAttribute('id'));
								const existingDep = rec.dependencies.find(d => d.onValue === onValue);
								if (existingDep) {
									existingDep.childFields.push(...childFields);
									existingDep.childFields = Array.from(new Set(existingDep.childFields));
								} else {
									rec.dependencies.push({
										onValue,
										childFields
									});
								}
							});
						}
					});
				}
			};

			/* -----------------------------------------
			   Exporter
			------------------------------------------*/
			const Exporter = {
				download(type) {
					const data = App.state.filteredData;
					if (type === 'csv') {
						this._downloadCsv(data);
					} else if (type === 'excel') {
						this._downloadExcel(App.state);
					}
				},
				_flattenData(data) {
					return data.map(item => {
						const na = {
							isRequired: 'N/A',
							isReadOnly: 'N/A',
							isHidden: 'N/A'
						};
						const newEdit = item.layouts.newEdit || na;
						const detail = item.layouts.detail;
						const history = item.layouts.history;
						const db = item.dbInfo || {};

						let defaultValues = [];
						if (item.layoutDefaultValue) defaultValues.push(`Layout: ${item.layoutDefaultValue}`);
						if (db.DefaultValue) defaultValues.push(`Field: ${db.DefaultValue}`);
						const combinedDefaultValue = defaultValues.length > 0 ? defaultValues.join(', ') : '-';

						let detailStatus = 'N/A';
						if (detail) {
							detailStatus = detail.isHidden === 'Yes' ? 'H' : 'D';
						}

						let historyStatus = 'N/A';
						if (history) {
							historyStatus = history.isHidden === 'Yes' ? 'H' : 'D';
						}

						let combinedLovs = '-';
						if (item.lovs.layout && item.lovs.layout.length > 0) {
							combinedLovs = item.lovs.layout.join(' | ');
						} else if (item.lovs.database && item.lovs.database.length > 0) {
							combinedLovs = item.lovs.database.join(' | ');
						}

						return {
							'Layout Label': item.layoutLabel,
							'DB Field Label': db.Label || '-',
							'Field ID': item.fieldId,
							'Layout State ID': item.layoutStateID || '-',
							'Layout State Name': item.layoutStateName || '-',
							'Data Type': db.FieldType || 'N/A',
							'Default Value': combinedDefaultValue,
							'Length': db.Length || '-',
							'Column Name': db.ColumnName || 'N/A',
							'New/Edit - Required': newEdit.isRequired,
							'New/Edit - ReadOnly': newEdit.isReadOnly,
							'New/Edit - Hidden': newEdit.isHidden,
							'Detail Status': detailStatus,
							'History Status': historyStatus,
							'LOVs': combinedLovs,
							'Dependency Condition': item.dependencyCondition || (item._isChild ? 'Child field (orphaned/parent may be in other state)' : 'None')
						};
					});
				},
				_downloadCsv(data) {
					const flatData = this._flattenData(data);
					if (flatData.length === 0) {
						UI.renderError("No data to export for the current filter.");
						return;
					}
					const headers = Object.keys(flatData[0]);
					let csvContent = headers.map(h => `"${h.replace(/"/g, '""')}"`).join(',') + '\r\n';
					flatData.forEach(row => {
						const values = headers.map(header => {
							let cell = row[header] === null || row[header] === undefined ? '' : String(row[header]);
							cell = `"${cell.replace(/"/g, '""')}"`;
							return cell;
						});
						csvContent += values.join(',') + '\r\n';
					});
					this._triggerDownload(csvContent, 'Layout_Analysis.csv', 'text/csv;charset=utf-8;');
				},
				_downloadExcel(state) {
					const dataToExport = state.filteredData || state.finalData;
					if (!dataToExport || dataToExport.length === 0) {
						UI.renderError("No data to export.");
						return;
					}
					const wb = XLSX.utils.book_new();
					XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(this._flattenData(dataToExport)), "Field Analysis");
					if (state.buttons.size > 0) XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(Array.from(state.buttons.values())), "Custom Buttons");
					if (state.cards.size > 0) XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(Array.from(state.cards.values())), "UI Cards");
					XLSX.writeFile(wb, 'Layout_Analysis_Report.xlsx');
				},
				_triggerDownload(content, fileName, mimeType) {
					const a = document.createElement('a');
					const blob = new Blob([content], {
						type: mimeType
					});
					a.href = URL.createObjectURL(blob);
					a.download = fileName;
					document.body.appendChild(a);
					a.click();
					document.body.removeChild(a);
				}
			};

			/* -----------------------------------------
			   DarkMode & Theming
			------------------------------------------*/
			const DarkMode = {
				init() {
					this.menuBtn = document.getElementById('theme-menu-btn');
					this.menu = document.getElementById('theme-menu');
					this.menuBtn.addEventListener('click', (e) => this.toggleMenu(e));

					document.querySelectorAll('[data-theme]').forEach(btn => {
						btn.addEventListener('click', (e) => this.setTheme(e.currentTarget.dataset.theme));
					});
					document.querySelectorAll('[data-theme-mode]').forEach(btn => {
						btn.addEventListener('click', (e) => this.setThemeMode(e.currentTarget.dataset.themeMode));
					});

					document.addEventListener('click', (e) => {
						if (!this.menu.contains(e.target) && !this.menuBtn.contains(e.target)) {
							this.menu.classList.add('hidden');
						}
					});

					const savedTheme = localStorage.getItem('theme') || 'indigo';
					const savedMode = localStorage.getItem('theme-mode') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');

					this.applyTheme(savedTheme, savedMode);
				},

				toggleMenu(e) {
					e.stopPropagation();
					this.menu.classList.toggle('hidden');
				},

				setTheme(name) {
					localStorage.setItem('theme', name);
					this.applyTheme(name, localStorage.getItem('theme-mode') || 'light');
					this.menu.classList.add('hidden');
				},

				setThemeMode(mode) {
					localStorage.setItem('theme-mode', mode);
					this.applyTheme(localStorage.getItem('theme') || 'indigo', mode);
				},

				applyTheme(themeName, mode) {
					document.body.classList.remove('theme-indigo', 'theme-emerald', 'theme-rose');
					document.body.classList.add(`theme-${themeName}`);
					if (mode === 'dark') {
						document.documentElement.classList.add('dark');
						document.body.classList.add('dark');
					} else {
						document.documentElement.classList.remove('dark');
						document.body.classList.remove('dark');
					}

					const header = document.querySelector('h1');
					const colors = getComputedStyle(document.documentElement);
					const startColor = colors.getPropertyValue('--primary-color-start');
					const endColor = colors.getPropertyValue('--primary-color-end');
					header.style.backgroundImage = `linear-gradient(to right, ${startColor}, ${endColor})`;
				}
			};

			const BackToTop = {
				init() {
					this.btn = document.getElementById('back-to-top');
					window.addEventListener('scroll', () => this.onScroll());
					this.btn.addEventListener('click', () => this.scrollToTop());
				},
				onScroll() {
					if (window.scrollY > 300) {
						this.btn.style.display = 'block';
					} else {
						this.btn.style.display = 'none';
					}
				},
				scrollToTop() {
					window.scrollTo({
						top: 0,
						behavior: 'smooth'
					});
				}
			}

			/* -----------------------------------------
			   Boot
			------------------------------------------*/
			document.addEventListener('DOMContentLoaded', () => App.init());
		</script>
	</body>
</html>
